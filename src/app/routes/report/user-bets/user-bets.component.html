<page-header [action]="action">
  <ng-template #action>
    <button (click)='download_report_all()' style='width:100px;margin: 4px 10px 0 8px;float:right' nz-button nzBlock
      [nzType]="'dashed'" class="ant-btn__block mb-sm">
      <i *ngIf='!is_down_load_all' nz-icon nzType="cloud-download" nzTheme="outline"></i>
      <i *ngIf='is_down_load_all' nz-icon nzType="loading" nzTheme="outline"></i>
      <span>导出所有</span>
    </button>
    <button (click)='download_report()' style='width:100px;margin: 4px 10px 0 8px;float:right' nz-button nzBlock
      [nzType]="'dashed'" class="ant-btn__block mb-sm">
      <i *ngIf='!is_down_load' nz-icon nzType="cloud-download" nzTheme="outline"></i>
      <i *ngIf='is_down_load' nz-icon nzType="loading" nzTheme="outline"></i>
      <span>导出当页</span>
    </button>
  </ng-template>
</page-header>
<nz-layout>
  <nz-content>
    <div>

      <div style='padding-top: 20px' nz-row nzGutter="16">
        <div nz-col nzSpan="20">
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">注单编号</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <input nz-input nzSize="small" placeholder="注单编号" [(ngModel)]="searchData.serial_number" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="10">
            <nz-form-item>
              <nz-form-label nz-col [nzSpan]="4">用户名</nz-form-label>
              <nz-form-control nz-col [nzSpan]="14">
                <input nz-input nzSize="small" placeholder="用户名" [(ngModel)]="searchData.username" />
              </nz-form-control>
              <nz-form-control style=' max-height: 40px' [nzSpan]="6">
                <label nz-checkbox [(ngModel)]="searchData.get_sub">查下级</label>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">奖期号</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <input nz-input nzSize="small" placeholder="奖期号" [(ngModel)]="searchData.issue" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="4">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">测试人员</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzSize="small" style="width: 100%;" [(ngModel)]="searchData.is_tester" nzAllowClear
                  nzPlaceHolder="是否测试用户">
                  <nz-option nzValue="" nzLabel="全部"></nz-option>
                  <nz-option nzValue="1" nzLabel="是"></nz-option>
                  <nz-option nzValue="0" nzLabel="否"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">开奖状态</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzSize="small" style="width: 100%;" [(ngModel)]="searchData.status" nzAllowClear
                  nzPlaceHolder="开奖状态">
                  <nz-option nzValue="" nzLabel="全部"></nz-option>
                  <nz-option nzValue="0" nzLabel="待开奖"></nz-option>
                  <nz-option nzValue="1" nzLabel="已撤销"></nz-option>
                  <nz-option nzValue="2" nzLabel="未中奖"></nz-option>
                  <nz-option nzValue="4" nzLabel="已派奖"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">元角模式</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzSize="small" style="width: 100%;" [(ngModel)]="searchData.mode" nzAllowClear
                  nzPlaceHolder="元角模式">
                  <nz-option nzValue="" nzLabel="全部"></nz-option>
                  <nz-option nzValue="1.0000" nzLabel="元"></nz-option>
                  <nz-option nzValue="0.1000" nzLabel="角"></nz-option>
                  <nz-option nzValue="0.0100" nzLabel="分"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">IP</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <input nz-input nzSize="small" placeholder="ip" [(ngModel)]="searchData.ip" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">游戏玩法</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-cascader nzSize="small" [nzOptions]="LotteriesOptions" placeholder="彩种ID"
                  [(ngModel)]="searchData.lottery_sign" [nzShowSearch]="true">
                </nz-cascader>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="4">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">投注模式</nz-form-label>
              <nz-form-control [nzSpan]="16">
                  <nz-select nzSize="small" style="width: 100%;" [(ngModel)]="searchData.price" nzAllowClear
                  nzPlaceHolder="开奖状态">
                  <nz-option nzValue="" nzLabel="全部"></nz-option>
                  <nz-option nzValue="1.0000" nzLabel="1元模式"></nz-option>
                  <nz-option nzValue="2.0000" nzLabel="2元模式"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="5">
            <nz-form-item>
              <nz-form-label [nzSpan]="8">每页条数</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzSize="small" style="width: 100%;" [(ngModel)]="searchData.pageSize" nzAllowClear>
                  <nz-option nzValue='20' nzLabel="20"></nz-option>
                  <nz-option nzValue='50' nzLabel="50"></nz-option>
                  <nz-option nzValue='100' nzLabel="100"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col nzSpan="8">
            <nz-form-item>
              <nz-form-label [nzSpan]="4">投注时间</nz-form-label>
              <nz-form-control [nzSpan]="20">
                <nz-range-picker nzSize="small" [(ngModel)]="searchData.start_time" (ngModelChange)="onChange($event)"
                  nzShowTime></nz-range-picker>&nbsp;&nbsp;
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div nz-col nzSpan="4">
          <button nz-button nzType="primary" class="select-search" (click)="search()"><i nz-icon
              type="search"></i>搜索</button>&nbsp;&nbsp;
          <button nz-button nzType="primary" class="select-reset" (click)="resetSearch()"><i nz-icon
              type="sync"></i>重置</button>
        </div>
      </div>
    </div>
    <nz-table #nzTable nzSize="middle" nzBordered [nzScroll]='{x:"1630px", y: "500px" }' [nzLoadingDelay]='500'
      (nzPageIndexChange)='chang_page_index($event)' [nzLoading]='is_load_list' [(nzPageIndex)]='page_index'
      [nzFrontPagination]='false' [nzData]="list_of_aply_data" [nzPageSize]='searchData.pageSize'
      [nzTotal]='list_total'>
      <thead class="ant-table-thead">
        <tr>
          <th nzWidth="70px">注单编号</th>
          <th nzWidth="70px">追号编号</th>
          <th nzWidth=90px>用户名称</th>
          <th nzWidth="70px">测试</th>
          <th nzWidth="70px">彩种</th>
          <th nzWidth="70px">玩法</th>
          <th nzWidth="120px">奖期号</th>
          <th nzWidth="120px"> 投注号码</th>
          <th nzWidth=90px>开奖号码 </th>
          <th nzWidth="70px">倍数</th>
          <th nzWidth="70px">模式</th>
          <th nzWidth="70px">投注模式</th>
          <th nzWidth=70px>总投注额</th>
          <th nzWidth=70px>中奖金额 </th>
          <th nzWidth=70px>中奖倍数 </th>
          <th nzWidth=70px>投注注数 </th>
          <th nzWidth="70px">状态</th>
          <th nzWidth=70px>奖金组</th>
          <th nzWidth=70px>ip</th>
          <th nzWidth=70px>操作</th>
        </tr>
      </thead>
      <tbody class="ant-table-tbody">
        <!-- <ng-template cdkDrag ngFor let-data [ngForOf]="nzTable.data"> -->
        <tr class='table_tr' *ngFor="let data of list_of_aply_data">
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.serial_number)'>
            <span style='width:70px'>{{data.serial_number}}</span>
          </td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.issue)'>
            <span style='width:70px'>{{data.trace_number}}</span>
          </td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.username)'>
            <span style='width:90px'>{{data.username}}</span>
          </td>
          <td><span >{{data.is_tester==1?'是':'否'}}</span></td>
          <td><span >{{data.lottery_sign}}</span></td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.method_name)'>
            <span style='width:70px'>{{data.method_name}}</span>
          </td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.issue)'>
            <span style='width: 120px'>{{ data.issue }}</span>
          </td>
          <td class='home-change-color' (click)='showBetNum(data.bet_number)'>
            <span style='width: 120px'>{{data.bet_number|betNumber}}</span>
          </td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.open_number)'>
            <span style='width: 90px'>{{data.open_number}}</span>
          </td>
          <td> <span >{{data.times}}</span></td>
          <td><span >{{data.mode|unit}}</span></td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.price)'>
            <span style='width:70px'>{{data.price}}</span>
          </td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.total_cost)'>
            <span style='width:70px'>{{data.total_cost}}</span>
          </td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.bonus)'>
            <span style='width:70px'>{{data.bonus}}</span>
          </td>
          <td><span ></span></td>
          <td><span></span></td>
          <td> <span style='width:70px'>{{ data.status|userBet }}</span></td>
          <td><span style='width:70px'>{{ data.bet_prize_group }}</span></td>
          <td class='home-change-color' (click)='utilsService.show_modal_text(data.ip)'>
            <span style='width: 70px'>{{data.ip}}</span>
          </td>
          <td>
            <button (click)='showDetail(data)' nz-button [nzSize]='"small"' nzType="primary">查看</button>
          </td>
        </tr>
      </tbody>
    </nz-table>
    <nz-drawer nzWidth='600px' [nzVisible]="visibleModal" nzPlacement="right" nzTitle="注单详情"
      (nzOnClose)="visibleModal=false">
      <div>
          <nz-descriptions  nzBordered nzLayout="vertical">
              <nz-descriptions-item nzTitle="用户名称">{{checkBetData['username']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="注单编号" [nzSpan]="2">{{checkBetData['serial_number']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="追号编号" >{{checkBetData['trace_number']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="彩种">{{checkBetData['lottery_sign']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="玩法">{{checkBetData['method_name']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="是否测试">{{checkBetData['is_tester'] === 1 ? '是' : '否'}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="奖期号">{{checkBetData['issue']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="投注号码">{{checkBetData['bet_number']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="开奖号码" [nzSpan]="2">{{checkBetData['open_number']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="倍数" >{{checkBetData['times']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="元角模式" >{{checkBetData['mode']|unit}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="投注模式" >{{checkBetData['price']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="总投注额" >{{checkBetData['total_cost']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="中奖金额" >{{checkBetData['bonus']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="中奖倍数" ></nz-descriptions-item>
              <nz-descriptions-item nzTitle="中奖注数" ></nz-descriptions-item>
              <nz-descriptions-item nzTitle="状态" >{{checkBetData['open_number']|userBet}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="奖金组" >{{checkBetData['bet_prize_group']}}</nz-descriptions-item>
              <nz-descriptions-item nzTitle="IP地址" >{{checkBetData['ip']}}</nz-descriptions-item>
        
            </nz-descriptions>
      </div>
    </nz-drawer>
  </nz-content>
</nz-layout>